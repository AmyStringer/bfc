\documentclass{bioinfo}
\copyrightyear{2015}
\pubyear{2015}

\usepackage{amsmath}
\usepackage[ruled,vlined]{algorithm2e}
\newcommand\mycommfont[1]{\footnotesize\rmfamily{\it #1}}
\SetCommentSty{mycommfont}
\SetKwComment{Comment}{$\triangleright$\ }{}
\usepackage{natbib}

\bibliographystyle{apalike}


\begin{document}
\firstpage{1}

\title[Error Correction for Illumina Data]{Correcting Illumina sequencing errors for human data}

\author[Li]{Heng Li}

\address{Broad Institute, 75 Ames Street, Cambridge, MA 02142, USA}

\history{Received on XXXXX; revised on XXXXX; accepted on XXXXX}
\editor{Associate Editor: XXXXXXX}
\maketitle

\begin{abstract}
\section{Summary:}

\section{Availability and implementation:} https://github.com/lh3/bfc

\section{Contact:} hengli@broadinstitute.org
\end{abstract}

\section{Introduction}

\begin{methods}
\section{Methods}
The BFC error correction algorithm is based on the $k$-mer
spectrum~\citep{Pevzner:2001vn}. It takes a list of trusted $k$-mers and
attempts to find a corrected sequence such that each $k$-mer on the corrected
sequence is trusted. There are multiple ways to implement this basic idea.
Algorithm~1 gives the BFC implementation. It defines a \emph{state} of
correction as a 4-tuple $(i,W,\mathcal{C},p)$, which consists of the position
$i$ of the preceding base, the last \mbox{($k$-1)--mer} $W$ ending at
$i$, the set $\mathcal{C}$ of previous corrected positions and bases (called a
\emph{solution}) up to $i$, and the penalty $p$ of solution $\mathcal{C}$.  BFC
keeps all possible states in a priority queue $\mathcal{Q}$. At each iteration,
it retrieves the state $(i,W,\mathcal{C},p)$ with the lowest penalty $p$ and
adds a new state $(i+1,W[1,k-2]\circ a,\mathcal{C}',p')$ if $a$ is the read
base or $W\circ a$ is a trusted $k$-mer. We find the optimal solution when we
come to the end of the read. This algorithm may change a base on a trusted
$k$-mer if doing this leads to more trusted $k$-mers later. Some algorithms
such as BLESS~\citep{Heo:2014aa} and Lighter~\citep{Song:2014aa} apparently do
not backtrack to change a wrong base assignment at an early iteration.

The worse-case time complexity of Algorithm~1 is exponential in the length of
the read. In implementation, we skip line~1 if the read base is Q20 and the
$k$-mer ending at it is trusted, or if five bases or two Q20 bases have been
corrected in the last 10bp window by default. The heuristics reduce the
search space. If BFC still takes too many iterations before finding an optimal
solution, we stop the search and mark the read not correctable.

\begin{algorithm}[ht]
\DontPrintSemicolon
\footnotesize
\KwIn{K-mer size $k$, set $\mathcal{H}$ of trusted k-mers, and one string $S$}
\KwOut{Set of corrected positions and bases changed to}
\BlankLine
\textbf{Function} {\sc CorrectErrors}$(k, \mathcal{H}, S)$
\Begin {
	$\mathcal{Q}\gets${\sc HeapInit}$()$\Comment*[r]{$\mathcal{Q}$ is a priority queue}
	{\sc HeapPush}$(\mathcal{Q}, (k-2, S[0,k-2], \emptyset, 0))$\Comment*[r]{0-based strings}
	\While{$\mathcal{Q}$ is not empty} {
		$(i, W, \mathcal{C}, p)\gets${\sc HeapPopBest}$(\mathcal{Q})$\Comment*[r]{current best state}
		$i\gets i+1$\;
		\lIf{$i=|S|$} { {\bf return} $\mathcal{C}$ \Comment*[f]{reaching the end of $S$}}
		\ForEach (\Comment*[f]{try all possible next bases}) {$a\in\{{\rm A},{\rm C},{\rm G},{\rm T}\}$} {
			$W'\gets W\circ a$\Comment*[r]{``$\circ$'' concatenates strings}
			\uIf (\Comment*[f]{``$a$'' is the read base}) {$a=S[i]$} {
				\eIf (\Comment*[f]{good read base; no penalty}) {$W'\in\mathcal{H}$} {
					{\sc HeapPush}$(\mathcal{Q}, (i,W'[1,k-1],\mathcal{C}, p))$\;
				} (\Comment*[f]{bad read base; penalize}) {
					{\sc HeapPush}$(\mathcal{Q}, (i,W'[1,k-1],\mathcal{C}, p+1))$\;
				}
			} \ElseIf (\Comment*[f]{make a correction with penalty}) {$W'\in \mathcal{H}$} {
				\nl{\sc HeapPush}$(\mathcal{Q}, (i,W'[1,k-1],\mathcal{C}\cup\{(i,a)\},p+1))$\;
			}
		}
	}
}
\caption{Error correction for one string in one direction}
\end{algorithm}

\end{methods}

\section{Results and Discussions}

We evaluated BFC along with BLESS~\citep{Heo:2014aa},
Bloocoo~\citep{Drezen:2014aa}, fermi2~\citep{Li:2012fk},
Lighter~\citep{Song:2014aa}, Musket~\citep{Liu:2013ac} and
SGA~\citep{Simpson:2012aa} on real data (Table~1).

\begin{table}[ht]
\processtable{Performance of error correction}
{\footnotesize
\begin{tabular}{lcrrccrr}
\toprule
Prog.     & K-mer & Time & RAM   & Perfect & Chimeric & Better & Worse \\
\midrule
BFC       & 37    & 7.4h & 63.5G &{\bf 3.04M}& 12.5k  & 830k   &{\bf 9.7k} \\
BLESS     & 31    & 6.5h & 22.3G & 2.91M   & 13.1k    & 674k   & 20.8k  \\
Bloocoo   & 31    &5.7h&{\bf 4.0G}& 2.88M  & 14.1k    & 764k   & 31.5k  \\
Fermi2    & 29    &17.2h & 64.7G & 3.00M   & 17.7k    &{\bf 849k}&42.8k \\
Lighter   & 31    &{\bf 3.2h}& 13.4G&2.98M & 13.0k    & 756k   & 30.1k  \\
Musket    & 27    &21.6h & 77.5G & 2.94M   & 22.5k    & 790k   & 36.3k  \\
SGA       & 55    &48.7h & 35.6G & 3.01M  &{\bf 12.1k}& 755k   & 12.8k  \\
\botrule
\end{tabular}}{4.45 million pairs of $\sim$150bp reads were
downloaded from BaseSpace, under the sample ``NA12878-L7'' of project
``HiSeq X Ten: TruSeq Nano (4 replicates of NA12878)''. Reads were corrected
together. 55-mer for SGA was used according to its paper. The maximal k-mer
length was used for other tools except BLESS. On a subset of two million
randomly sampled read pairs, the original and the corrected sequences were
mapped to hs37d5 (http://bit.ly/GRCh37d5) with BWA-MEM~\citep{Li:2013aa}. A
read is said to become \emph{better} (or \emph{worse}) if the best alignment of
the corrected sequence has more (or fewer) identical bases than the best of the
original sequence. The table gives the wall-clock \emph{time} when 16 threads
are specified if possible, the peak \emph{RAM} measured by GNU time, number of
corrected reads mapped \emph{perfectly}, number of \emph{chimeric} reads,
number of corrected reads becoming \emph{better} and the number of reads
becoming \emph{worse} than the original.}
% Fiona, Trowel and AllPaths-LG used >11GB RAM and got manually killed
% RACER uses more RAM than input read bases (Molnar and Ilie, 2014). It is not tested.

\end{table}

\section*{Acknowledgement}
\paragraph{Funding\textcolon} NHGRI U54HG003037; NIH GM100233

\bibliography{bfc}
\end{document}
